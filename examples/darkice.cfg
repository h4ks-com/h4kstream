# ============================================================================
# DarkIce Configuration for h4kstream Live Streaming
# ============================================================================
#
# SETUP INSTRUCTIONS:
# -------------------
# 1. Get a streaming token from the admin API:
#
#    TOKEN=$(curl -s -X POST http://localhost:8383/admin/livestream/token \
#      -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
#      -H "Content-Type: application/json" \
#      -d '{"max_streaming_seconds": 3600}' | jq -r '.token')
#
#    Replace YOUR_ADMIN_TOKEN with your actual admin token from .env
#
# 2. Update the password field below with your token
#
# 3. Run darkice:
#    darkice -c darkice.cfg
#
# STREAMING A FILE:
# -----------------
# DarkIce reads from audio devices, not files directly. To stream a file:
#
# Option 1: Use PulseAudio virtual sink (Linux)
#   pactl load-module module-null-sink sink_name=virtual_sink
#   ffmpeg -re -i yourfile.mp3 -f pulse virtual_sink
#   # Then configure DarkIce to read from virtual_sink.monitor
#
# Option 2: Use ffmpeg directly (recommended - see ffmpeg-stream.sh)
#   ffmpeg -re -i yourfile.mp3 -c:a libvorbis -b:a 128k \
#     -f ogg icecast://source:$TOKEN@localhost:8003/live
#
# Option 3: Use ALSA loopback (Linux)
#   sudo modprobe snd-aloop
#   ffmpeg -re -i yourfile.mp3 -f alsa hw:Loopback,0,0
#   # Configure DarkIce to read from hw:Loopback,1,0
#
# ============================================================================

[general]
duration        = 0           # 0 means forever
bufferSecs      = 5           # Buffer size in seconds
reconnect       = yes         # Reconnect if connection drops

[input]
device          = default     # Audio input device (ALSA/PulseAudio)
                              # Examples:
                              # - default (system default)
                              # - hw:0,0 (ALSA hardware device)
                              # - plughw:0,0 (ALSA with format conversion)
                              # - pulse (PulseAudio)
                              # - hw:Loopback,1,0 (ALSA loopback for file streaming)

sampleRate      = 48000       # Sample rate (Hz) - matches Liquidsoap output
bitsPerSample   = 16          # Bit depth
channel         = 2           # Stereo (1 = mono, 2 = stereo)

[icecast2-0]
bitrateMode     = cbr         # Constant bitrate
format          = vorbis      # Ogg Vorbis format
bitrate         = 128         # Bitrate in kbps
server          = localhost   # h4kstream server
port            = 8003        # Live streaming port
password        = YOUR_TOKEN_HERE    # <<< REPLACE WITH YOUR LIVESTREAM TOKEN
mountPoint      = live        # Mount point (must be 'live')
name            = My Live Stream
description     = Streaming to h4kstream
url             = http://localhost:8383
genre           = Various
public          = no          # Don't list in Icecast directory
localDumpFile   = /tmp/darkice-dump.ogg  # Optional: save local copy
